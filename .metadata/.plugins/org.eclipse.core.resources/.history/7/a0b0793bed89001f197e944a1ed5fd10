package Dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import Database.ConnectionFactory;
import Database.MySQLConnectionFactory;
import Database.PgSqlConnectionFactory;
import Model.Flight;
import Model.Seat;

public class SeatDaoImpl extends AbstractDao<Seat> {
	
	private FlightDaoImpl flightDao = new FlightDaoImpl();

	@Override
	public List<Seat> getAllSeats() {
		String sql = "SELECT * FROM SEATS";
		List<Seat> seats = new ArrayList<Seat>();
		try(Connection connection = connectionFactory.createConnection()) {
			PreparedStatement preparedStatement = connection.prepareStatement(sql);
			ResultSet resultSet = preparedStatement.executeQuery();
			while(resultSet.next()) {
				int id = resultSet.getInt("id");
				String seatType = resultSet.getString("seat_type");
				int flightid = resultSet.getInt("flight_id");
				String seatNumber = resultSet.getString("name");
				Flight flight = flightDao.getFlightByFlightId(flightid);
				seats.add(new Seat(id, seatType, flight,seatNumber));
			}
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return seats;
	}

	@Override
	public Seat getSeatById(int seatId) {
		String sql = "SELECT * FROM SEATS WHERE id = ?";
		Seat seat = null;
		try(Connection connection = connectionFactory.createConnection()) {
			PreparedStatement preparedStatement = connection.prepareStatement(sql);
			preparedStatement.setInt(1, seatId);
			ResultSet resultSet = preparedStatement.executeQuery();
			if(resultSet.next()) {
				int id = resultSet.getInt("id");
				String seatType = resultSet.getString("seat_type");
				int flightid = resultSet.getInt("flight_id");
				Flight flight = flightDao.getById(flightid);
				String seatNumber = resultSet.getString("name");
				seat = new Seat(seatId, seatType, flight, seatNumber);
			}
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return seat;
	}

	@Override
	public void add(Seat seat) {
		String sql = "INSERT INTO SEATS(seat_type,flight_id,name) VALUES(?,?,?)";
		try(Connection connection = connectionFactory.createConnection()) {
			PreparedStatement preparedStatement = connection.prepareStatement(sql);
			preparedStatement.setString(1,seat.getSeatType());
			preparedStatement.setInt(2, seat.getFlight().getFlightid());
			preparedStatement.setString(3, seat.getSeatNumber());
			preparedStatement.executeUpdate();
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}

	@Override
	public String gettableName() {
		return "SEATS";
	}

	@Override
	public Seat convertToObject(ResultSet resultset) throws SQLException {
		int id = resultset.getInt("id");
		String seatType = resultset.getString("seat_type");
		int flightid = resultset.getInt("flight_id");
		Flight flight = flightDao.getById(flightid);
		String seatNumber = resultset.getString("name");
		Seat seat = new Seat(id, seatType, flight, seatNumber);
		return seat;
	}

	}



