package Dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import Database.ConnectionFactory;
import Database.MySQLConnectionFactory;
import Database.PgSqlConnectionFactory;
import Model.Airport;
import Model.Flight;
import Model.Route;

public class RouteDaoImpl extends AbstractDao<Route> {
	
	private ConnectionFactory connectionFactory;
	private AirportDaoImpl airportdao = new AirportDaoImpl();
	
	public RouteDaoImpl() {
		this.connectionFactory = new PgSqlConnectionFactory();
	}

	@Override
	public List<Route> getAllRoutes() {
		String sql = "SELECT * FROM ROUTES";
		List<Route> routes = new ArrayList<Route>();
		try(Connection connection = connectionFactory.createConnection()) {
			PreparedStatement preparedStatement = connection.prepareStatement(sql);
			ResultSet resultSet = preparedStatement.executeQuery();
			while(resultSet.next()) {
				int id = resultSet.getInt("id");
				int arrival = resultSet.getInt("arrive_airport_id");
				Airport arrivalairport = airportdao.getById(arrival);
				int dept = resultSet.getInt("dept_airport_id");
				Airport deptairport = airportdao.getById(dept);
				int distance = resultSet.getInt("distance");
				routes.add(new Route(id,deptairport, arrivalairport, distance));
			}
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return routes;
	}

	@Override
	public Route getRouteById(int id) {
		String sql = "SELECT * FROM ROUTES WHERE id = ?";
		Route route = null;
		try(Connection connection = connectionFactory.createConnection()) {
			PreparedStatement preparedStatement = connection.prepareStatement(sql);
			preparedStatement.setInt(1, id);
			ResultSet resultSet = preparedStatement.executeQuery();
			if(resultSet.next()) {
				int Routeid = resultSet.getInt("id");
				int arrival = resultSet.getInt("arrive_airport_id");
				Airport arrivalairport = airportdao.getAirportById(arrival);
				int dept = resultSet.getInt("dept_airport_id");
				Airport deptairport = airportdao.getAirportById(dept);
				int distance = resultSet.getInt("distance");
				route = new Route(deptairport, arrivalairport, distance);
			}
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return route;
	}

	@Override
	public void add(Route route) {
		String sql = "INSERT INTO ROUTES(arrive_airport_id,dept_airport_id,distance,flight_id) VALUES (?,?,?,?)";
		try(Connection connection = connectionFactory.createConnection()) {
			PreparedStatement preparedStatement = connection.prepareStatement(sql);
			preparedStatement.setInt(1, route.getArrivalAirport().getAirportId());
			preparedStatement.setInt(2, route.getDepatureAirport().getAirportId());
			preparedStatement.setInt(3, route.getDistance());
			preparedStatement.executeUpdate();
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}

	@Override
	public String gettableName() {
		return "Route";
	}

	@Override
	public Route convertToObject(ResultSet resultset) throws SQLException {

	}

}
